<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NR-09: Anomaly Distribution</title>
  <style>
    body {
      background-color: #0d0d0d;
      color: #00ffcc;
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }

    h1 {
      font-size: 1.5em;
      margin-bottom: 20px;
      letter-spacing: 2px;
    }

    #turn-indicator {
      margin-bottom: 30px;
      font-size: 1.2em;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 120px);
      gap: 20px;
    }

    .word-button {
      background: #111;
      border: 1px solid #00ffcc;
      color: #00ffcc;
      padding: 30px;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      letter-spacing: 1px;
    }

    .word-button:hover {
      background-color: #003333;
    }

    .word-button:disabled {
      background-color: #222;
      color: #888;
      cursor: not-allowed;
      border: 1px solid #444;
    }

    .log {
      margin-top: 30px;
      width: 60%;
      border-top: 1px solid #00ffcc;
      padding-top: 20px;
      font-size: 0.95em;
      line-height: 1.6;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

<h1>NR-09</h1>
<div id="turn-indicator">User 1, choose your rasa</div>

<div class="grid" id="button-grid"></div>

<pre class="log" id="log"></pre>

<script>
  const wordsPool = ['SHNG', 'HSYA', 'VRA', 'KRNA', 'BBTS', 'BYNK', 'RDRA', 'ADBT'];
  const users = ['User 1', 'User 2', 'User 3', 'User 4'];

  const groupA = ['BBTS', 'VRA', 'BYNK', 'RDRA'];
  const groupB = ['KRNA', 'HSYA', 'ADBT', 'SHNG'];

  const forbiddenPairs = [
    ['BBTS', 'SHNG'],
    ['BBTS', 'KRNA']
  ];

  let assigned = {
    'User 1': [],
    'User 2': [],
    'User 3': [],
    'User 4': []
  };

  let shuffledWords = [...wordsPool].sort(() => Math.random() - 0.5);
  let clickIndex = 0;

  const grid = document.getElementById('button-grid');
  const turnIndicator = document.getElementById('turn-indicator');
  const log = document.getElementById('log');

  // Create 8 buttons
  for (let i = 0; i < 8; i++) {
    const btn = document.createElement('button');
    btn.className = 'word-button';
    btn.addEventListener('click', () => handleClick(btn, i));
    grid.appendChild(btn);
  }

  function handleClick(button, buttonIndex) {
    if (clickIndex >= 8 || button.disabled) return;

    const userIndex = clickIndex % 4;
    const user = users[userIndex];
    const isFirstPick = assigned[user].length === 0;

    let selectedWord;

    if (isFirstPick) {
      selectedWord = shuffledWords.shift();
    } else {
      const firstWord = assigned[user][0];
      selectedWord = findValidPair(firstWord);
    }

    if (!selectedWord) return;

    assigned[user].push(selectedWord);
    button.textContent = selectedWord;
    button.disabled = true;

    clickIndex++;
    updateLog();

    if (clickIndex < 8) {
      const nextUser = users[clickIndex % 4];
      turnIndicator.textContent = `${nextUser}, choose your rasa.`;
    } else {
      turnIndicator.textContent = "All anomalies distributed";
    }
  }

  function findValidPair(firstWord) {
    for (let i = 0; i < shuffledWords.length; i++) {
      const candidate = shuffledWords[i];
      if (isValidPair(firstWord, candidate)) {
        shuffledWords.splice(i, 1); // Remove from pool
        return candidate;
      }
    }
    return null;
  }

  function isValidPair(word1, word2) {
    const sameGroup =
      (groupA.includes(word1) && groupA.includes(word2)) ||
      (groupB.includes(word1) && groupB.includes(word2));

    const isForbidden = forbiddenPairs.some(
      pair => pair.includes(word1) && pair.includes(word2)
    );

    return !sameGroup && !isForbidden;
  }

  function updateLog() {
    log.textContent = '';
    users.forEach(user => {
      const selections = assigned[user].join(', ');
      log.textContent += `${user}: ${selections}\n`;
    });
  }
</script>

</body>
</html>
