<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NR-09: Anomaly Distribution</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Oxanium:wght@200..800&display=swap');

    body {
      background-color: #0d0d0d;
      color: #00ffcc;
      font-family: 'Oxanium', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }

    h1 {
      font-size: 1.5em;
      margin-bottom: 20px;
      letter-spacing: 2px;
    }

    #turn-indicator {
      margin-bottom: 30px;
      font-size: 1.2em;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 100px);
      gap: 50px;
      margin-top: 70px;
      margin-bottom: 70px;
      justify-content: center;
    }

    .word-button {
      background: transparent;
      border: none;
      padding: 0;
      cursor: pointer;
      width: 80px;
      height: 80px;
      position: relative;
    }

    .word-button img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: opacity 2s ease;
    }

    .fade-out {
      opacity: 0;
    }

    .word-box {
      width: 100%;
      height: 100%;
      background: #111;
      border: 1px solid #00ffcc;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 2s ease;
      position: absolute;
      top: 0;
      left: 0;
      box-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc, 0 0 30px #00ffcc;

    }

    .word-box img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .word-box.visible {
      opacity: 1;
    }

    .log-container {
      margin-top: 40px;
      width: 80%;
      border-top: 1px solid #00ffcc;
      padding-top: 20px;
      display: flex;
      justify-content: space-around;
      text-align: center;
    }

    .user-log {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 100px;
    }

    .user-title {
      font-weight: bold;
      margin-bottom: 10px;
    }

    .log-entry {
      font-size: 1em;
      opacity: 0;
      transition: opacity 1s ease;
      text-shadow: 0 0 5px #00ffcc, 0 0 10px #00ffcc;
    }

    .log-entry.visible {
      opacity: 1;
    }

    .blinking-cursor {
  font-weight: bold;
  margin-left: 5px;
  animation: blink 1s infinite;
}

@keyframes blink {
  0%, 50% {
    opacity: 1;
  }
  50.01%, 100% {
    opacity: 0;
  }
}

  </style>
</head>

<body>

<h1>MF-25<span class="blinking-cursor">_</span></h1>
<div id="turn-indicator">User 1, choose:</div>

<div class="grid" id="button-grid"></div>

<div class="log-container" id="log-container">
  <div class="user-log" id="user-1-log"><div class="user-title">USER 1</div></div>
  <div class="user-log" id="user-2-log"><div class="user-title">USER 2</div></div>
  <div class="user-log" id="user-3-log"><div class="user-title">USER 3</div></div>
  <div class="user-log" id="user-4-log"><div class="user-title">USER 4</div></div>
</div>

<script>
  const wordsPool = ['SHNG', 'HSYA', 'VRA', 'KRNA', 'BBTS', 'BYNK', 'RDRA', 'ADBT'];
  const users = ['User 1', 'User 2', 'User 3', 'User 4'];

  const groupA = ['BBTS', 'VRA', 'BYNK', 'RDRA'];
  const groupB = ['KRNA', 'HSYA', 'ADBT', 'SHNG'];

  const forbiddenPairs = [
    ['BBTS', 'SHNG'],
    ['BBTS', 'KRNA']
  ];

  const correlations = {
    'BYNK': 'BHAYANAK',
    'RDRA': 'RAUDRA',
    'BBTS': 'BIBHATSA',
    'KRNA': 'KARUNA',
    'SHNG': 'SHRINGAR',
    'ADBT': 'ADBHUTA',
    'HSYA': 'HASYA',
    'VRA': 'VEERA'
  };

  let assigned = {
    'User 1': [],
    'User 2': [],
    'User 3': [],
    'User 4': []
  };

  let shuffledWords = [...wordsPool].sort(() => Math.random() - 0.5);
  let clickIndex = 0;

  const grid = document.getElementById('button-grid');
  const turnIndicator = document.getElementById('turn-indicator');

  // Create 8 buttons
  for (let i = 0; i < 8; i++) {
    const btn = document.createElement('button');
    btn.className = 'word-button';
    btn.disabled = false;

    const img = document.createElement('img');
    img.src = 'folder.png';
    img.alt = 'folder';

    btn.appendChild(img);
    btn.addEventListener('click', () => handleClick(btn, img, i));
    grid.appendChild(btn);
  }

  function handleClick(button, image, buttonIndex) {
    if (clickIndex >= 8 || button.classList.contains('disabled')) return;

    const userIndex = clickIndex % 4;
    const user = users[userIndex];
    const isFirstPick = assigned[user].length === 0;

    let selectedWord;

    if (isFirstPick) {
      selectedWord = shuffledWords.shift();
    } else {
      const firstWord = assigned[user][0];
      selectedWord = findValidPair(firstWord);
    }

    if (!selectedWord) return;

    assigned[user].push(selectedWord);
    clickIndex++;

    image.classList.add('fade-out');

    setTimeout(() => {
      image.style.display = 'none';

      const wordBox = document.createElement('div');
      wordBox.className = 'word-box';

      // Add image instead of text
      const rasaImage = document.createElement('img');
      rasaImage.src = `images/${selectedWord}.png`;  // Placeholder path
      rasaImage.alt = correlations[selectedWord] || selectedWord;

      wordBox.appendChild(rasaImage);
      button.appendChild(wordBox);

      // Fade in image
      setTimeout(() => {
        wordBox.classList.add('visible');

        // Log text label below
        const logId = `user-${userIndex + 1}-log`;
        const userLogDiv = document.getElementById(logId);
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.textContent = correlations[selectedWord] || selectedWord;
        userLogDiv.appendChild(entry);

        setTimeout(() => {
          entry.classList.add('visible');
        }, 10);

        if (clickIndex < 8) {
          const nextUser = users[clickIndex % 4];
          turnIndicator.textContent = `${nextUser}, choose:`;
        } else {
          turnIndicator.textContent = "All anomalies distributed";
        }

      }, 1000);
    }, 1000);

    button.classList.add('disabled');
    button.disabled = true;
  }

  function findValidPair(firstWord) {
    for (let i = 0; i < shuffledWords.length; i++) {
      const candidate = shuffledWords[i];
      if (isValidPair(firstWord, candidate)) {
        shuffledWords.splice(i, 1);
        return candidate;
      }
    }
    return null;
  }

  function isValidPair(word1, word2) {
    const sameGroup =
      (groupA.includes(word1) && groupA.includes(word2)) ||
      (groupB.includes(word1) && groupB.includes(word2));

    const isForbidden = forbiddenPairs.some(
      pair => pair.includes(word1) && pair.includes(word2)
    );

    return !sameGroup && !isForbidden;
  }
</script>

</body>
</html>
