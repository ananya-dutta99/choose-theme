<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NR-09</title>
  <style>
    body {
      background-color: #0d0d0d;
      color: #00ffcc;
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }

    h1 {
      font-size: 1.5em;
      margin-bottom: 20px;
      letter-spacing: 2px;
    }

    #turn-indicator {
      margin-bottom: 30px;
      font-size: 1.2em;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(4, 120px);
      gap: 20px;
    }

    .word-button {
      background: #111;
      border: 1px solid #00ffcc;
      color: #00ffcc;
      padding: 30px;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      letter-spacing: 1px;
    }

    .word-button:hover {
      background-color: #003333;
    }

    .word-button:disabled {
      background-color: #222;
      color: #888;
      cursor: not-allowed;
      border: 1px solid #444;
    }

    .log {
      margin-top: 30px;
      width: 60%;
      border-top: 1px solid #00ffcc;
      padding-top: 20px;
      font-size: 0.95em;
      line-height: 1.6;
      white-space: pre-wrap;
      color: #00ffcc;
    }
  </style>
</head>
<body>

<h1>NR-09</h1>
<div id="turn-indicator">Player 1, choose your first word</div>

<div class="grid" id="button-grid"></div>

<pre class="log" id="log"></pre>

<script>
  const words = ['SHNG', 'HSYA', 'VRA', 'KRNA', 'BBTS', 'BYNK', 'RDRA', 'ADBT'];
  const players = ['Player 1', 'Player 2', 'Player 3', 'Player 4'];

  // Define groups
  const groupA = ['BBTS', 'VRA', 'BYNK', 'RDRA'];
  const groupB = ['KRNA', 'HSYA', 'ADBT', 'SHNG'];

  let assigned = {
    'Player 1': [],
    'Player 2': [],
    'Player 3': [],
    'Player 4': []
  };

  let currentPlayerIndex = 0;
  let round = 1;
  let clickCount = 0;

  const grid = document.getElementById('button-grid');
  const turnIndicator = document.getElementById('turn-indicator');
  const log = document.getElementById('log');

  // Shuffle for randomness
  const shuffledWords = [...words].sort(() => Math.random() - 0.5);

  shuffledWords.forEach((word) => {
    const btn = document.createElement('button');
    btn.className = 'word-button';

    btn.dataset.word = word;
    btn.addEventListener('click', () => handleClick(btn, word));
    grid.appendChild(btn);
  });

  function handleClick(button, word) {
    const currentPlayer = players[currentPlayerIndex];
    const alreadyChosen = assigned[currentPlayer];

    // Rule check on second word
    if (alreadyChosen.length === 1) {
      const first = alreadyChosen[0];

      if (!isValidPair(first, word)) {
        alert(`Invalid pair: ${first} + ${word}\n(violates pairing rules)`);
        return;
      }
    }

    button.textContent = word;
    button.disabled = true;
    assigned[currentPlayer].push(word);
    updateLog();

    clickCount++;
    if (clickCount % 4 === 0 && clickCount < 8) {
      round++;
      currentPlayerIndex = 0;
    } else {
      currentPlayerIndex = (currentPlayerIndex + 1) % 4;
    }

    if (clickCount < 8) {
      const nextPlayer = players[currentPlayerIndex];
      turnIndicator.textContent = `${nextPlayer}, choose your ${round === 1 ? 'first' : 'second'} word`;
    } else {
      turnIndicator.textContent = "All words assigned. Distribution complete.";
    }
  }

  function isValidPair(word1, word2) {
    // Rule 1: Must not be in same group
    if (
      (groupA.includes(word1) && groupA.includes(word2)) ||
      (groupB.includes(word1) && groupB.includes(word2))
    ) {
      return false;
    }

    // Rule 2: BBTS must not pair with SHNG or KRNA
    const blockedPairs = [
      ['BBTS', 'SHNG'],
      ['BBTS', 'KRNA']
    ];

    return !blockedPairs.some(
      pair => (pair.includes(word1) && pair.includes(word2))
    );
  }

  function updateLog() {
    log.textContent = '';
    players.forEach(player => {
      const selections = assigned[player].join(', ');
      log.textContent += `${player}: ${selections}\n`;
    });
  }
</script>

</body>
</html>
